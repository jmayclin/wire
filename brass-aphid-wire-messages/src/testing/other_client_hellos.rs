use s2n_tls_sys::s2n_mode::CLIENT;

use crate::{
    codec::DecodeValue,
    protocol::{ClientHello, HandshakeMessageHeader, RecordHeader},
};

const AWS_DEFAULT: &str = "16030301930100018f0303a8d24391b2c2b468f861919912c784b6d0f25cf7dcf143568b77026c9c5e2e2e20dd81de4d128b4812936ab35a681ca28d82d59d0a72a078eb7cf189e582d50772002a003c009c009dc0130035c028c027002fc02cc009003dc0241301c02b130200ffc00ac023c02fc014c0300100011c000500050100000000000a00160014001d001700180019001e01000101010201030104000b00020100001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00050403040303002d000201010032002c002a040305030603080708080804080508060809080a080b04010501060104020303030103020203020102020033006b0069001d0020adb3dc2f3f2234e08995c4138579755684fa32401c37007d490940209db65e630017004104c9cba934603fb7d433e3cee59528f24c951ea31c75ffd87c754649ea710fd555094b3ae087ec74139dbec444b6731cac0c77719527ddd354cb158a13fbafa7ad";
const CDO_CLIENT_APPROVED: &str = "16030301820100017e0303e0f8439c7a883c7755f4b7733997ad4379780e7f474c363296e67334de67edf820debc5c19b3418337cbed0fbed7030a27fe7b90af46278b9f0be8b7e8ec5863600014003c009cc0130035c027002fc00913011302c02f01000121000500050100000000000a00160014001d001700180019001e01000101010201030104000b00020100001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00050403040303002d000201010032002c002a040305030603080708080804080508060809080a080b04010501060104020303030103020203020102020033006b0069001d0020f2a791406d64c8736411b890f0b1f633434d4f589ab97d0b83336863db937327001700410438d500a8533348ec45534404fd289c77d3c06347caf06973252c42f52e61461c9ceb8be30aa29f33721ca91a64a3faba9049a23ebd51f51095f5e4c91c30846eff01000100";
const RETAIL_EXTERNAL: &str = "16030301800100017c03038a2511d6e48f11f05966fd3fb47369f4af77c8237cb4a63e5c162441fe88a6fc208596913f190f6c836cf9ba411ef0aedcea391e04bdd866c72401fac5fd9159530012c013c027c0091301c02b1302c023c02f003301000121000500050100000000000a00160014001d001700180019001e01000101010201030104000b00020100001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00050403040303002d000201010032002c002a040305030603080708080804080508060809080a080b04010501060104020303030103020203020102020033006b0069001d0020508cb1b070466c60f9df322baab37f82a56172936a8ffbcec40e70d91d9aac1800170041046e608392e44a4795b1afaffccf244dfbfc2ccd0494e2c8fda5a1b3bc9977f557c059c3d99fa75d157a3ab13d19af8f4dcea655d4b2011f4cac65ed46db619c83ff01000100";
const RETAIL_HWLB: &str = "16030300bb010000b70303b80825448442d91446a33c58bdc78ca5f127540aa80eaa0d016d57aa5bd23d850000040035002f0100008a000500050100000000001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00030203030032002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202ff01000100";
const RETAIL_SUBSIDIARY: &str = "160303017a010001760303088db19a254049fad20053254fe468ba9a296afcc9affee4ef16fe889ca56e48203c8e78869673614b04097177a6641a45f83d3ed7b18529c39a0f91682a96e76c000cc0271301c02b1302c023c02f01000121000500050100000000000a00160014001d001700180019001e01000101010201030104000b00020100001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00050403040303002d000201010032002c002a040305030603080708080804080508060809080a080b04010501060104020303030103020203020102020033006b0069001d00205d781d35e0d623d7d519ab964c8bff9164269e8f1e593b8e27c525722a2aa22b0017004104cb1d1beaa85e276bb1cc165be686933ac63d604dddc344290d1f73d696767dfa0997e2207cedf78b24798361e3237890cececa3cd1a28c7329c862eb0b9d74faff01000100";
const RETAIL_INTERNAL: &str = "160303017a0100017603033c77e203c08bb384dc1bfa16b78c5bdcc51fef91b0cf413212c753f6a9f88105201ce0c29fbeaf1ef4134a064e9ef83195db3cfa6ec1c5da981b6611d70ee22959000cc0271301c02b1302c023c02f01000121000500050100000000000a00160014001d001700180019001e01000101010201030104000b00020100001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00050403040303002d000201010032002c002a040305030603080708080804080508060809080a080b04010501060104020303030103020203020102020033006b0069001d002076dd55b730ba96142ece0151a27772e2944d6e5eb6682af3939a98d6acb79a0f00170041045c5ee610bdbecc35bf06fa6a8bd9a8d37a9ac93ae643cf7b1b68d6e0f058fba07a77040825e8120794997d3f1f3d65fbdb079576e54b0a2e553144f50d33c0bcff01000100";
const LEGACY_CLIENT: &str = "16030301b3010001af03038b91a8607b67ad1654ac706ddb97ae12ae9e31ba2948250df26c2776d8be610c20912bf83dad9d729e3ef7bafdd32dabbc5058b7b44d52047317824d15f03c996d004a130213011303c02cc02bcca9c030cca8c02f009fccaa00a3009e00a2c024c028c023c027006b006a00670040c00ac014c009c0130039003800330032009d009c003d003c0035002f00ff0100011c000500050100000000000a00160014001d001700180019001e01000101010201030104000b00020100001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00050403040303002d000201010032002c002a040305030603080708080804080508060809080a080b04010501060104020303030103020203020102020033006b0069001d002084ada23b0766cb24ff96323f1a4e80ac137c9e8a67d8613686a1c7f7b6372a2800170041046654fce0973db28f728a545094e35e09bae5d13a6a561b4863bb98e6827c14705f144808a0785c0ef95c48c28735d66377a7fa6c26b8799c4aadf49a0a097e2f";
const LEGACY_STRICTSSL: &str = "16030301a6010001a2030326b927a8aa2259c7e4c60437eed150bd215dd2073b65abe3934a4521b488696620bcedde9aa2a0ce8a15ee2f8a62e06af9ce079aede0fbb60771ffbd8e9401e3900038003c00a3009c00400067009d003500a2c028009fc027009e002fc02c003dc0241301c02b00381302006bc023006a0039c02f00330032c03001000121000500050100000000000a00160014001d001700180019001e01000101010201030104000b00020100001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00050403040303002d000201010032002c002a040305030603080708080804080508060809080a080b04010501060104020303030103020203020102020033006b0069001d0020d435557a17ff4315eaaa5494846d7f5defe1bd6b404951ddc1e8bf8c708e436900170041045c46b789ea01efa4cbdbee30fc159f8cf98c6d75911aae261f04345f509451f92c88fc8cca3c29c5dc07478ffd0fb31b38feead9fe29e1aabfa6158ac0009750ff01000100";
#[derive(Debug)]
enum SecurityPolicies {
    AwsDefault,
    CdoClientApproved,
    RetailExternal,
    RetailHwlb,
    RetailSubsidiary,
    RetailInternal,
    LegacyClient,
    LegacyStrictSsl,
}

impl SecurityPolicies {
    fn client_hello(&self) -> &'static str {
        match self {
            SecurityPolicies::AwsDefault => AWS_DEFAULT,
            SecurityPolicies::CdoClientApproved => CDO_CLIENT_APPROVED,
            SecurityPolicies::RetailExternal => RETAIL_EXTERNAL,
            SecurityPolicies::RetailHwlb => RETAIL_HWLB,
            SecurityPolicies::RetailSubsidiary => RETAIL_SUBSIDIARY,
            SecurityPolicies::RetailInternal => RETAIL_INTERNAL,
            SecurityPolicies::LegacyClient => LEGACY_CLIENT,
            SecurityPolicies::LegacyStrictSsl => LEGACY_STRICTSSL,
        }
    }
}

#[test]
fn java_stuff() {
    for policy in [
        SecurityPolicies::AwsDefault,
        SecurityPolicies::CdoClientApproved,
        SecurityPolicies::RetailExternal,
        SecurityPolicies::RetailHwlb,
        SecurityPolicies::RetailSubsidiary,
        SecurityPolicies::RetailInternal,
        SecurityPolicies::LegacyClient,
        SecurityPolicies::LegacyStrictSsl
    ] {
        let bytes = hex::decode(policy.client_hello()).unwrap();
        let (rh, remaining) = RecordHeader::decode_from(&bytes).unwrap();
        let (hh, remaining) = HandshakeMessageHeader::decode_from(remaining).unwrap();
        let (ch, remaining) = ClientHello::decode_from(remaining).unwrap();
        assert_eq!(remaining.len(), 0);
        println!("{ch:#?}");
        std::fs::write(format!("netty_{policy:?}.client_hello"), format!("{ch:#?}")).unwrap();
    }
}


#[test]
fn apache() {
    const CLIENT_HELLO: &str = "16030301b3010001af0303310569c4ddcc9d77f64783d199c8e1862b23b28d99a3cb86822f64a0f8f3d635201960f4c578b9b6d609a998e0685088488ae5947ae3879addcc642194707bf497004a130213011303c02cc02bcca9c030cca8c02f009fccaa00a3009e00a2c024c028c023c027006b006a00670040c00ac014c009c0130039003800330032009d009c003d003c0035002f00ff0100011c000500050100000000000a00160014001d001700180019001e01000101010201030104000b00020100001100090007020004000000000017000000230000000d002c002a040305030603080708080804080508060809080a080b0401050106010402030303010302020302010202002b00050403040303002d000201010032002c002a040305030603080708080804080508060809080a080b04010501060104020303030103020203020102020033006b0069001d00203247a63fbd63314b19831adaa17e07bb1ea1bb831b7de7c6cc0c03a77d2fd72000170041042f25436fab88b8f14734c6594474c0cde62b568aa8beb3dbfa2074b08d10a6f75ef4bdff0ba6df61819c32e351a61ea789fc342bbc0b690765ff5d217218b749";
let bytes = hex::decode(CLIENT_HELLO).unwrap();
        let (rh, remaining) = RecordHeader::decode_from(&bytes).unwrap();
        let (hh, remaining) = HandshakeMessageHeader::decode_from(remaining).unwrap();
        let (ch, remaining) = ClientHello::decode_from(remaining).unwrap();
        assert_eq!(remaining.len(), 0);
        println!("{ch:#?}");
        std::fs::write(format!("apache.client_hello"), format!("{ch:#?}")).unwrap();
}